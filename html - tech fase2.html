<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio Interativo: Pipeline de Dados da B3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Tech -->
    <!-- Application Structure Plan: A tabbed, single-page dashboard designed for a technical audience. Key sections include an interactive architecture diagram, detailed component exploration via clickable cards/modals, a results section with live Chart.js visualizations, and an accordion for technical challenges. This non-linear structure prioritizes user-driven exploration over the linear format of the source report, allowing users to quickly access the information most relevant to them. Gemini features are added to each section to provide deeper, contextual explanations and insights. -->
    <!-- Visualization & Content Choices: 
    - Report Info: Architecture Diagram -> Goal: Organize/Inform -> Viz/Presentation: Static Image Diagram -> Interaction: None -> Justification: User provided a specific diagram to be used. Method: IMG tag.
    - Report Info: Component Details -> Goal: Inform -> Viz/Presentation: Clickable Cards with Modals -> Interaction: Click to reveal details -> Justification: Reduces initial information overload, allows progressive disclosure. Method: HTML/CSS with JS events. Pre-defined text is used to explain components in context.
    - Report Info: Analysis Results (Top 10 Stocks) -> Goal: Compare/Inform -> Viz/Presentation: Horizontal Bar Chart -> Interaction: Tooltips on hover -> Justification: Clearly visualizes rankings and proportions. Library: Chart.js (Canvas). Pre-defined text is used to generate business insights from chart data.
    - Report Info: Technical Challenges -> Goal: Inform/Organize -> Viz/Presentation: Accordion -> Interaction: Click to expand/collapse -> Justification: Organizes complex information concisely. Method: HTML/CSS with JS events. Pre-defined text is used to suggest alternative technical solutions.
    - CONFIRMATION: NO SVG/Mermaid used. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #1e293b; /* slate-800 */
        }
        .tab-active {
            border-color: #0ea5e9; /* sky-500 */
            color: #0ea5e9; /* sky-500 */
            background-color: #f0f9ff; /* sky-50 */
        }
        .tab-inactive {
            border-color: transparent;
            color: #475569; /* slate-600 */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 500px;
            }
        }
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Relat√≥rio Interativo do Projeto</h1>
            <p class="text-5xl md:text-6xl font-extrabold text-sky-600 mt-2">Pipeline de Dados da B3</p>
            <p class="mt-4 max-w-3xl mx-auto text-slate-600">
                Uma explora√ß√£o interativa da arquitetura, implementa√ß√£o e resultados do pipeline de dados serverless para ingest√£o e processamento da composi√ß√£o do √≠ndice Ibovespa.
            </p>
        </header>

        <nav class="mb-8 border-b border-slate-200">
            <ul class="flex flex-wrap -mb-px justify-center text-sm font-medium text-center">
                <li class="mr-2">
                    <button class="tab-button inline-block p-4 border-b-2 rounded-t-lg tab-active" data-tab="visao-geral">Vis√£o Geral</button>
                </li>
                <li class="mr-2">
                    <button class="tab-button inline-block p-4 border-b-2 rounded-t-lg tab-inactive" data-tab="componentes">Componentes</button>
                </li>
                <li class="mr-2">
                    <button class="tab-button inline-block p-4 border-b-2 rounded-t-lg tab-inactive" data-tab="resultados">Resultados</button>
                </li>
                <li class="mr-2">
                    <button class="tab-button inline-block p-4 border-b-2 rounded-t-lg tab-inactive" data-tab="desafios">Desafios T√©cnicos</button>
                </li>
            </ul>
        </nav>

        <main>
            <section id="visao-geral" class="content-section active">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-slate-800">Arquitetura do Pipeline</h2>
                    <p class="mb-6 text-slate-600">
                        A solu√ß√£o foi arquitetada em um padr√£o event-driven, desacoplando as responsabilidades de coleta, orquestra√ß√£o e processamento. O diagrama abaixo ilustra o fluxo completo de dados, desde a fonte na B3 at√© a camada de an√°lise no Amazon Athena.
                    </p>
                    <div class="relative p-4 md:p-8 bg-slate-100 rounded-lg">
                        <img src="https://i.postimg.cc/pXs0L4Cn/arq.png" alt="Diagrama da Arquitetura do Pipeline de Dados da B3" class="w-full max-w-5xl mx-auto rounded-lg shadow-lg">
                    </div>
                </div>
            </section>

            <section id="componentes" class="content-section">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-slate-800">Detalhes dos Componentes</h2>
                    <p class="mb-6 text-slate-600">
                        Cada servi√ßo na arquitetura desempenha um papel crucial. Explore os cart√µes abaixo para entender a l√≥gica e a responsabilidade de cada componente do pipeline.
                    </p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="component-cards">
                        <div class="component-card border border-slate-200 p-5 rounded-lg flex flex-col">
                            <h3 class="font-bold text-lg text-amber-700">üïí EventBridge Rule</h3>
                            <p class="text-sm text-slate-600 mt-2 flex-grow">Configurado com uma express√£o `cron` para execu√ß√£o di√°ria, atua como o gatilho agendado que inicia todo o pipeline de ingest√£o de dados de forma aut√¥noma.</p>
                            <button class="ia-explain-btn mt-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-component-key="eventbridge">‚ú® Explicar com IA</button>
                        </div>
                        <div class="component-card border border-slate-200 p-5 rounded-lg flex flex-col">
                            <h3 class="font-bold text-lg text-orange-700">Œª Lambda: scrapb3</h3>
                            <p class="text-sm text-slate-600 mt-2 flex-grow">Respons√°vel pela coleta dos dados. Executa um web scraping da API da B3, trata a pagina√ß√£o e serializa os dados brutos para o formato Parquet, depositando-os na zona `raw` do S3.</p>
                             <button class="ia-explain-btn mt-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-component-key="lambda-scrapb3">‚ú® Explicar com IA</button>
                        </div>
                        <div class="component-card border border-slate-200 p-5 rounded-lg flex flex-col">
                            <h3 class="font-bold text-lg text-red-700">üóÉÔ∏è S3 Bucket: raw/</h3>
                            <p class="text-sm text-slate-600 mt-2 flex-grow">Atua como a zona de "landing" ou "bronze" do Data Lake. Armazena os dados brutos, imut√°veis e n√£o processados, servindo como a fonte da verdade para o restante do pipeline.</p>
                             <button class="ia-explain-btn mt-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-component-key="s3-raw">‚ú® Explicar com IA</button>
                        </div>
                        <div class="component-card border border-slate-200 p-5 rounded-lg flex flex-col">
                            <h3 class="font-bold text-lg text-orange-700">Œª Lambda: orquestrador-glue</h3>
                            <p class="text-sm text-slate-600 mt-2 flex-grow">Acionada por eventos de cria√ß√£o de objetos no S3, esta fun√ß√£o orquestra o ETL. Primeiro, ela limpa os diret√≥rios de destino para garantir a idempot√™ncia e, em seguida, inicia o Job do AWS Glue.</p>
                             <button class="ia-explain-btn mt-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-component-key="lambda-orquestrador">‚ú® Explicar com IA</button>
                        </div>
                        <div class="component-card border border-slate-200 p-5 rounded-lg flex flex-col">
                            <h3 class="font-bold text-lg text-cyan-700">‚ú® AWS Glue Job</h3>
                            <p class="text-sm text-slate-600 mt-2 flex-grow">O cora√ß√£o do ETL. Constru√≠do no Glue Studio, executa transforma√ß√µes complexas em PySpark, como limpeza de dados, convers√£o de tipos, enriquecimento com novas colunas e agrega√ß√£o, gerando duas sa√≠das distintas.</p>
                             <button class="ia-explain-btn mt-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-component-key="glue">‚ú® Explicar com IA</button>
                        </div>
                        <div class="component-card border border-slate-200 p-5 rounded-lg flex flex-col">
                            <h3 class="font-bold text-lg text-green-700">üóÇÔ∏è S3 Buckets: refined/ & summarized/</h3>
                            <p class="text-sm text-slate-600 mt-2 flex-grow">As zonas "silver" e "gold" do Data Lake. `refined/` armazena os dados detalhados e particionados, enquanto `summarized/` cont√©m os dados agregados, ambos prontos para consumo anal√≠tico.</p>
                             <button class="ia-explain-btn mt-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-component-key="s3-refined">‚ú® Explicar com IA</button>
                        </div>
                         <div class="component-card border border-slate-200 p-5 rounded-lg flex flex-col">
                            <h3 class="font-bold text-lg text-blue-700">üìñ Glue Data Catalog</h3>
                            <p class="text-sm text-slate-600 mt-2 flex-grow">Atua como o metastore central. O Job do Glue atualiza automaticamente as tabelas e parti√ß√µes, tornando os dados no S3 "pesquis√°veis" e compreens√≠veis para servi√ßos de consulta como o Athena.</p>
                             <button class="ia-explain-btn mt-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-component-key="catalog">‚ú® Explicar com IA</button>
                        </div>
                        <div class="component-card border border-slate-200 p-5 rounded-lg flex flex-col">
                            <h3 class="font-bold text-lg text-indigo-700">üîç Amazon Athena</h3>
                            <p class="text-sm text-slate-600 mt-2 flex-grow">Servi√ßo de consulta interativo que permite a an√°lise dos dados no S3 usando SQL padr√£o. Ele l√™ os metadados do Glue Data Catalog para executar consultas perform√°ticas, especialmente em dados particionados.</p>
                             <button class="ia-explain-btn mt-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-component-key="athena">‚ú® Explicar com IA</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="resultados" class="content-section">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-slate-800">An√°lise e Resultados</h2>
                    <p class="mb-6 text-slate-600">
                        O pipeline culmina em dados refinados e prontos para an√°lise. As visualiza√ß√µes abaixo demonstram insights chave sobre a composi√ß√£o do √≠ndice Ibovespa.
                    </p>
                    <div class="space-y-12">
                        <div>
                            <h3 class="text-xl font-semibold text-center mb-4">Top 10 A√ß√µes por Participa√ß√£o no IBOV</h3>
                            <div class="chart-container">
                                <canvas id="top10Chart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-center mb-4">Participa√ß√£o Agregada por Tipo de A√ß√£o</h3>
                            <div class="chart-container" style="max-width: 450px; height: 450px;">
                                <canvas id="typeChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="mt-12 text-center">
                        <button id="ia-insight-btn" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                            ‚ú® Gerar Insight Anal√≠tico com IA
                        </button>
                    </div>
                </div>
            </section>

            <section id="desafios" class="content-section">
                 <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-slate-800">Desafios T√©cnicos Superados</h2>
                    <p class="mb-6 text-slate-600">
                        A constru√ß√£o do pipeline envolveu a supera√ß√£o de diversos desafios t√©cnicos. Explore as se√ß√µes abaixo para entender os problemas encontrados e as solu√ß√µes implementadas.
                    </p>
                    <div class="space-y-4">
                        <div class="accordion-item border border-slate-200 rounded-lg">
                            <button class="accordion-header w-full text-left p-4 font-semibold flex justify-between items-center">
                                Compatibilidade de Depend√™ncias (GLIBC)
                                <span class="accordion-icon text-xl">+</span>
                            </button>
                            <div class="accordion-content px-4">
                                <p class="text-sm text-slate-600 pb-4">
                                    <strong>Problema:</strong> A Lambda Layer, constru√≠da em um ambiente de desenvolvimento padr√£o, continha bin√°rios incompat√≠veis com o runtime do Lambda (Amazon Linux 2), resultando em erros de 'GLIBC'.<br>
                                    <strong>Solu√ß√£o:</strong> A Layer foi reconstru√≠da utilizando Docker com a imagem oficial `public.ecr.aws/lambda/python:3.10`, garantindo 100% de compatibilidade bin√°ria com o ambiente de execu√ß√£o do Lambda.
                                </p>
                                <button class="ia-optimize-btn mb-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-challenge-key="glibc">‚ú® Sugerir Otimiza√ß√£o com IA</button>
                            </div>
                        </div>
                        <div class="accordion-item border border-slate-200 rounded-lg">
                            <button class="accordion-header w-full text-left p-4 font-semibold flex justify-between items-center">
                                Limites de Tamanho da Lambda Layer
                                <span class="accordion-icon text-xl">+</span>
                            </button>
                            <div class="accordion-content px-4">
                                <p class="text-sm text-slate-600 pb-4">
                                    <strong>Problema:</strong> As depend√™ncias (`pandas`, `pyarrow`) excediam os limites de tamanho da Lambda (50MB para upload direto, 250MB descompactado).<br>
                                    <strong>Solu√ß√£o:</strong> Foi aplicado um processo de otimiza√ß√£o agressiva, utilizando `strip` para remover s√≠mbolos de depura√ß√£o e deletando manualmente m√≥dulos n√£o essenciais da `pyarrow` para reduzir drasticamente o tamanho final do pacote.
                                </p>
                                <button class="ia-optimize-btn mb-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-challenge-key="size-limit">‚ú® Sugerir Otimiza√ß√£o com IA</button>
                            </div>
                        </div>
                        <div class="accordion-item border border-slate-200 rounded-lg">
                            <button class="accordion-header w-full text-left p-4 font-semibold flex justify-between items-center">
                                Idempot√™ncia e Duplica√ß√£o de Dados
                                <span class="accordion-icon text-xl">+</span>
                            </button>
                            <div class="accordion-content px-4">
                                <p class="text-sm text-slate-600 pb-4">
                                    <strong>Problema:</strong> Reexecu√ß√µes do Job do Glue para testes resultavam em dados duplicados na camada `refined`, pois o Glue adicionava novos arquivos sem remover os antigos.<br>
                                    <strong>Solu√ß√£o:</strong> Foi implementada uma Lambda orquestradora (`orquestrador-glue`) que executa uma l√≥gica de `purge` (limpeza) nos diret√≥rios de destino do S3 antes de iniciar o Job do Glue, garantindo que cada execu√ß√£o seja limpa e idempotente.
                                </p>
                                <button class="ia-optimize-btn mb-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-challenge-key="idempotency">‚ú® Sugerir Otimiza√ß√£o com IA</button>
                            </div>
                        </div>
                         <div class="accordion-item border border-slate-200 rounded-lg">
                            <button class="accordion-header w-full text-left p-4 font-semibold flex justify-between items-center">
                                Qualidade e Formato dos Dados de Origem
                                <span class="accordion-icon text-xl">+</span>
                            </button>
                            <div class="accordion-content px-4">
                                <p class="text-sm text-slate-600 pb-4">
                                    <strong>Problema:</strong> Os dados num√©ricos da B3 utilizavam padr√µes de formata√ß√£o brasileiros (v√≠rgula como separador decimal, ponto como separador de milhar), o que causava falhas de `cast` para tipos num√©ricos no Glue.<br>
                                    <strong>Solu√ß√£o:</strong> A l√≥gica de transforma√ß√£o foi encapsulada em um n√≥ "Custom Transform" em PySpark, utilizando `regexp_replace` para normalizar os formatos num√©ricos antes de convert√™-los para `double` e `long`.
                                </p>
                                <button class="ia-optimize-btn mb-4 text-xs font-semibold text-sky-600 hover:text-sky-800 self-start" data-challenge-key="data-format">‚ú® Sugerir Otimiza√ß√£o com IA</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="ia-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none modal-backdrop">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col modal-content scale-95">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="modal-title" class="text-xl font-bold text-slate-800">Resposta da IA</h3>
                <button id="modal-close-btn" class="text-slate-500 hover:text-slate-800 text-2xl leading-none">&times;</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <div id="modal-text-content" class="text-slate-700 space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabs = document.querySelectorAll('.tab-button');
            const sections = document.querySelectorAll('.content-section');
            const accordionItems = document.querySelectorAll('.accordion-item');
            
            const modal = document.getElementById('ia-modal');
            const modalContent = modal.querySelector('.modal-content');
            const modalTitle = document.getElementById('modal-title');
            const modalTextContent = document.getElementById('modal-text-content');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            const staticResponses = {
                explain: {
                    eventbridge: "O Amazon EventBridge, neste pipeline, funciona como um rel√≥gio agendador (cron job). Sua √∫nica responsabilidade √© 'acordar' a fun√ß√£o Lambda `scrapb3` em um hor√°rio pr√©-definido (diariamente), iniciando todo o processo de coleta de dados. Ele garante a automa√ß√£o e a consist√™ncia temporal da ingest√£o, eliminando a necessidade de qualquer interven√ß√£o manual.",
                    'lambda-scrapb3': "Esta fun√ß√£o Lambda √© o ponto de partida do trabalho com os dados. Ela √© altamente especializada em se comunicar com a API da B3, navegar por suas p√°ginas de resultados (pagina√ß√£o) e extrair a composi√ß√£o do √≠ndice. Utiliza as bibliotecas `requests` para a comunica√ß√£o e `pandas`/`pyarrow` para estruturar e salvar os dados brutos em um formato colunar otimizado (Parquet) na primeira zona do nosso Data Lake.",
                    's3-raw': "A pasta `raw/` no S3 √© a zona de pouso (landing zone) dos nossos dados. Ela armazena os dados exatamente como foram coletados, sem nenhuma transforma√ß√£o. Este princ√≠pio de armazenar o dado bruto √© fundamental em um Data Lake, pois garante que tenhamos uma fonte da verdade imut√°vel que pode ser reprocessada no futuro, caso as regras de neg√≥cio mudem.",
                    'lambda-orquestrador': "Esta fun√ß√£o Lambda atua como o maestro do pipeline de ETL. Acionada pela chegada de um novo arquivo na pasta `raw/`, ela executa duas tarefas essenciais: primeiro, realiza a limpeza dos diret√≥rios de destino (`refined/` e `summarized/`) para garantir a idempot√™ncia do processo (evitando duplicatas em reexecu√ß√µes). Em seguida, ela inicia o Job do AWS Glue, passando a ele a localiza√ß√£o do novo arquivo a ser processado.",
                    glue: "O AWS Glue Job √© o cora√ß√£o do nosso processo de ETL. Ele utiliza o poder do Apache Spark para executar transforma√ß√µes em larga escala. No nosso caso, ele l√™ os dados Parquet da zona `raw`, realiza a limpeza de formatos num√©ricos, converte tipos de dados, enriquece os dados com novas colunas (como `ano`, `mes`, `dia`, e m√©tricas de lat√™ncia) e, por fim, cria dois conjuntos de dados distintos: um detalhado e particionado e outro sumarizado.",
                    's3-refined': "Estas pastas representam as camadas mais valiosas do nosso Data Lake. A `refined/` (ou zona silver) cont√©m os dados detalhados, limpos, enriquecidos e particionados por data e c√≥digo de a√ß√£o, otimizados para consultas anal√≠ticas de alta performance. A `summarized/` (ou zona gold) cont√©m dados j√° agregados, prontos para consumo por dashboards e relat√≥rios gerenciais.",
                    catalog: "O Glue Data Catalog √© o c√©rebro do nosso Data Lake. Ele funciona como um cat√°logo central de metadados. O Job do Glue automaticamente registra e atualiza as informa√ß√µes sobre nossas tabelas (esquema, localiza√ß√£o no S3, parti√ß√µes). Isso permite que servi√ßos como o Amazon Athena descubram e consultem os dados sem precisar saber os detalhes de onde ou como os arquivos est√£o fisicamente armazenados.",
                    athena: "O Amazon Athena √© a interface de an√°lise do nosso Data Lake. Ele permite que qualquer usu√°rio com conhecimento de SQL execute consultas diretamente sobre os dados que est√£o no S3. Ele utiliza as informa√ß√µes do Glue Data Catalog para encontrar e ler os dados de forma otimizada, aproveitando o particionamento para reduzir custos e aumentar drasticamente a velocidade das consultas."
                },
                insight: `A an√°lise dos dados revela uma forte concentra√ß√£o do Ibovespa em poucos ativos, principalmente dos setores de commodities (minera√ß√£o, petr√≥leo) e financeiro. As 10 principais a√ß√µes correspondem a uma parcela significativa do peso total do √≠ndice. Al√©m disso, a predomin√¢ncia de a√ß√µes Ordin√°rias (ON) e Preferenciais (PN) reflete a estrutura de capital tradicional das grandes empresas brasileiras. Para um gestor de portf√≥lio, isso sinaliza que a performance do √≠ndice √© altamente sens√≠vel √†s flutua√ß√µes desses poucos pap√©is, indicando um risco de concentra√ß√£o e uma menor representatividade de outros setores da economia.`,
                optimization: {
                    glibc: "Uma estrat√©gia complementar robusta √© utilizar **Imagens de Cont√™iner Lambda** em vez de Layers. Ao empacotar a fun√ß√£o e suas depend√™ncias em uma imagem de cont√™iner baseada na imagem oficial da AWS para Amazon Linux 2, voc√™ tem controle total sobre o ambiente, eliminando qualquer risco de incompatibilidade de 'GLIBC' ou outras bibliotecas do sistema. Essa abordagem tamb√©m simplifica o gerenciamento de depend√™ncias complexas e √© a pr√°tica recomendada para cargas de trabalho de produ√ß√£o.",
                    'size-limit': "Para depend√™ncias extremamente grandes que, mesmo ap√≥s otimiza√ß√£o, se aproximam do limite, a melhor pr√°tica √© usar **Imagens de Cont√™iner Lambda**. O limite para imagens de cont√™iner √© de **10 GB**, o que elimina completamente a preocupa√ß√£o com o tamanho. Al√©m disso, a AWS otimiza o cache de layers da imagem, resultando em cold starts muitas vezes mais r√°pidos do que para fun√ß√µes com Layers muito grandes.",
                    idempotency: `Uma arquitetura alternativa e ainda mais desacoplada seria usar o **AWS Step Functions**. O S3 Trigger acionaria uma m√°quina de estados do Step Functions que orquestraria o fluxo:\n1.  **Primeiro passo:** Uma fun√ß√£o Lambda para realizar a limpeza (purge) das pastas de destino.\n2.  **Segundo passo:** A pr√≥pria defini√ß√£o do Step Functions iniciaria o Job do Glue, esperando por sua conclus√£o.\nEsta abordagem oferece maior visibilidade, tratamento de erros e resili√™ncia, com um workflow visual de toda a orquestra√ß√£o.`,
                    'data-format': `Para aumentar a resili√™ncia, a l√≥gica de transforma√ß√£o no Glue poderia ser aprimorada com um **tratamento de "dead-letter queue" (DLQ)**. No n√≥ "Custom Transform", poder√≠amos envolver a l√≥gica de convers√£o em um \`try-except\`. Linhas que falharem na convers√£o (por exemplo, um formato num√©rico inesperado) n√£o quebrariam o job. Em vez disso, seriam separadas em um novo DataFrame e salvas em uma localiza√ß√£o espec√≠fica no S3 (a DLQ), permitindo an√°lise posterior da causa da falha sem interromper o processamento dos registros v√°lidos.`
                }
            };
            
            function showModal(title, text) {
                modalTitle.textContent = title;
                modalTextContent.innerHTML = text.replace(/\n/g, '<br>');
                
                modal.classList.remove('opacity-0', 'pointer-events-none');
                modalContent.classList.remove('scale-95');
                
                document.body.style.overflow = 'hidden';
            }

            function hideModal() {
                modal.classList.add('opacity-0');
                modalContent.classList.add('scale-95');
                
                setTimeout(() => {
                    modal.classList.add('pointer-events-none');
                    document.body.style.overflow = 'auto';
                }, 300);
            }
            
            modalCloseBtn.addEventListener('click', hideModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal();
                }
            });

            document.querySelectorAll('.ia-explain-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const componentKey = e.target.dataset.componentKey;
                    const card = e.target.closest('.component-card');
                    const title = card.querySelector('h3').textContent.trim();
                    const responseText = staticResponses.explain[componentKey] || "Explica√ß√£o n√£o encontrada.";
                    showModal(`IA Explica: ${title}`, responseText);
                });
            });

            document.getElementById('ia-insight-btn').addEventListener('click', () => {
                const responseText = staticResponses.insight;
                showModal('IA Gera: Insight Anal√≠tico', responseText);
            });

            document.querySelectorAll('.ia-optimize-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const challengeKey = e.target.dataset.challengeKey;
                    const accordionItem = e.target.closest('.accordion-item');
                    const title = accordionItem.querySelector('.accordion-header').textContent.trim();
                    const responseText = staticResponses.optimization[challengeKey] || "Sugest√£o n√£o encontrada.";
                    showModal(`IA Sugere: Otimiza√ß√£o para ${title}`, responseText);
                });
            });

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    tabs.forEach(t => t.classList.replace('tab-active', 'tab-inactive'));
                    tab.classList.replace('tab-inactive', 'tab-active');
                    sections.forEach(s => s.classList.toggle('active', s.id === tabId));
                });
            });

            accordionItems.forEach(item => {
                const header = item.querySelector('.accordion-header');
                const content = item.querySelector('.accordion-content');
                const icon = item.querySelector('.accordion-icon');
                header.addEventListener('click', () => {
                    const isExpanded = content.style.maxHeight && content.style.maxHeight !== '0px';
                    if (isExpanded) {
                        content.style.maxHeight = '0px';
                        icon.textContent = '+';
                    } else {
                        content.style.maxHeight = content.scrollHeight + 'px';
                        icon.textContent = '-';
                    }
                });
            });

            const top10Data = {
                labels: ['VALE3', 'PETR4', 'ITUB4', 'BBDC4', 'B3SA3', 'PETR3', 'ELET3', 'ABEV3', 'WEGE3', 'RENT3'],
                datasets: [{
                    label: 'Participa√ß√£o (%)',
                    data: [13.5, 7.2, 6.8, 5.1, 4.5, 3.8, 3.2, 2.9, 2.5, 2.1],
                    backgroundColor: ['rgba(54, 162, 235, 0.6)', 'rgba(255, 99, 132, 0.6)', 'rgba(75, 192, 192, 0.6)', 'rgba(255, 206, 86, 0.6)', 'rgba(153, 102, 255, 0.6)', 'rgba(255, 159, 64, 0.6)', 'rgba(99, 255, 132, 0.6)', 'rgba(132, 99, 255, 0.6)', 'rgba(201, 203, 207, 0.6)', 'rgba(255, 159, 241, 0.6)'],
                    borderColor: ['rgba(54, 162, 235, 1)', 'rgba(255, 99, 132, 1)', 'rgba(75, 192, 192, 1)', 'rgba(255, 206, 86, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)', 'rgba(99, 255, 132, 1)', 'rgba(132, 99, 255, 1)', 'rgba(201, 203, 207, 1)', 'rgba(255, 159, 241, 1)'],
                    borderWidth: 1
                }]
            };

            const top10Ctx = document.getElementById('top10Chart').getContext('2d');
            new Chart(top10Ctx, {
                type: 'bar',
                data: top10Data,
                options: {
                    indexAxis: 'y',
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: (c) => ` ${c.dataset.label}: ${c.raw.toFixed(2)}%` } }
                    },
                    scales: { x: { beginAtZero: true, title: { display: true, text: 'Participa√ß√£o (%)' } } }
                }
            });

            const typeData = {
                labels: ['ON', 'PN', 'UNIT', 'PNB', 'PNA'],
                datasets: [{
                    label: 'Participa√ß√£o Agregada (%)',
                    data: [76.37, 35.71, 8.44, 1.90, 0.44],
                    backgroundColor: ['rgba(54, 162, 235, 0.7)', 'rgba(255, 99, 132, 0.7)', 'rgba(75, 192, 192, 0.7)', 'rgba(255, 206, 86, 0.7)', 'rgba(153, 102, 255, 0.7)'],
                    hoverOffset: 4
                }]
            };

            const typeCtx = document.getElementById('typeChart').getContext('2d');
            new Chart(typeCtx, {
                type: 'doughnut',
                data: typeData,
                options: {
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: { callbacks: { label: (c) => ` ${c.label}: ${c.raw.toFixed(2)}%` } }
                    }
                }
            });
        });
    </script>
</body>
</html>
